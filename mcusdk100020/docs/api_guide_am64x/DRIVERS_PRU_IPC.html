<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: PRU IPC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('DRIVERS_PRU_IPC.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PRU IPC </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2153">Features Supported</a></li>
<li class="level1"><a href="#autotoc_md2154">SysConfig Features</a></li>
<li class="level1"><a href="#autotoc_md2155">Features NOT Supported</a></li>
<li class="level1"><a href="#autotoc_md2156">Usage Guidelines</a><ul><li class="level2"><a href="#autotoc_md2157">Add PRU IPC using SysConfig</a></li>
<li class="level2"><a href="#DRIVERS_PRU_IPC_LINKER">Update linker command file</a></li>
<li class="level2"><a href="#autotoc_md2158">Update MPU for the CPU</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2159">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md2160">API</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_pru_io_pru_ipc"></a></p>
<p>PRU IPC module provides APIs for communicating with the PRU core with low latency. The communication is done in the form of blocks of data transfer in one exchange. Options are available for configuring multiple buffers and multiple blocks per buffer. The PRU sends one block of data for all buffers at a time, and the next block after that.</p>
<p>The block diagram for the PRU IPC communication is given below.</p>
<p> <style>div.image img[src="pru_ipc_arch.png"]{width:65%}</style> </p><div class="image">
<img src="pru_ipc_arch.png" alt=""/>
</div>
 <h1><a class="anchor" id="autotoc_md2153"></a>
Features Supported</h1>
<ul>
<li>Configurables: number of buffers, number of blocks, block size, data size</li>
<li>Interrupt option after a block of data is sent by PRU</li>
<li>Configurable shared memory location where the buffers will be placed - by specifying it in linker file</li>
<li>Optional interrupt to PRU after a block of data is sent by R5F</li>
<li>Custom interrupt mapping through ICSS INTC module</li>
</ul>
<h1><a class="anchor" id="autotoc_md2154"></a>
SysConfig Features</h1>
<dl class="section note"><dt>Note</dt><dd>It is strongly recommend to use SysConfig where it is available instead of using direct SW API calls. This will help simplify the SW application and also catch common mistakes early in the development cycle.</dd></dl>
<p>SysConfig is used for configuring all the PRU IPC options mentioned above, through PRU IPC module under PRU IO.</p>
<ul>
<li>Based on the configuration selected, the SysConfig generated code does following:<ul>
<li>Create macros like <code>CONFIG_PRU_IPC1</code> using the name passed in SysConfig. This is used as an input to <a class="el" href="group__DRV__PRU__IPC__MODULE.html#gaf8db5f54464b6defa5878970ba4a8e89">PRU_IPC_open</a> API.</li>
<li>Generates sample code for linker in <code>ti_drivers_config.c</code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md2155"></a>
Features NOT Supported</h1>
<ul>
<li>Currently only PRU cores are supported (not RTU PRU and TX PRU cores)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2156"></a>
Usage Guidelines</h1>
<h2><a class="anchor" id="autotoc_md2157"></a>
Add PRU IPC using SysConfig</h2>
<ul>
<li>Add a PRU IPC instance using SysConfig, by selecting <code>PRU IPC</code> under <code>PRU IO</code> in the left pane in SysConfig</li>
<li>Configure the instance as per requirements</li>
</ul>
<h2><a class="anchor" id="DRIVERS_PRU_IPC_LINKER"></a>
Update linker command file</h2>
<ul>
<li>A shared memory region between CPU and PRU-ICSS needs to be allocated which the PRU and R5F cores will use for exchanging data. The generated code in <code>ti_drivers_config.c</code> contains sample linker file code which needs to be placed in project's linker file.</li>
</ul>
<p> <style>div.image img[src="pru_ipc_linker.png"]{width:80%}</style> </p><div class="image">
<img src="pru_ipc_linker.png" alt=""/>
</div>
<h2><a class="anchor" id="autotoc_md2158"></a>
Update MPU for the CPU</h2>
<ul>
<li>The shared memory section (described in the above section) which was put in the linker command file needs to be mapped as <code>Cached+Sharable</code> for the CPU.</li>
<li><p class="startli">This can be done via SysConfig, by adding additional MPU entries using the <code>MPU</code> module under <code>TI DRIVER PORTING LAYER (DPL)</code> in SysConfig. Following is an example:</p>
<div class="image">
<img src="pru_ipc_mpu_config.png" alt=""/>
</div>
</li>
</ul>
<p>These APIs are for the R5F side. Please also look into the PRU side macros available for usage in PRU firmware.</p>
<h1><a class="anchor" id="autotoc_md2159"></a>
Example Usage</h1>
<p>The PRU IPC is being used in PRU-ADC interfacing examples in which PRU transfers the samples to R5F (to TCM). There, Number of channels correspond to number of buffers and packet size correspond to sample size.</p>
<p>Initialize PRU IPC Instance </p><div class="fragment"><div class="line">    <span class="comment">/* ----------------------------------------------------------------- */</span></div>
<div class="line">    <span class="comment">/* Initialize IPC between r5f and PRU cores                          */</span></div>
<div class="line">    <span class="comment">/* ----------------------------------------------------------------- */</span></div>
<div class="line">    <a class="code" href="structPRU__IPC__Params.html">PRU_IPC_Params</a> pruIpcparams = {</div>
<div class="line">                                .<a class="code" href="structPRU__IPC__Params.html#ac13215b71f32f013bc1cf0cc326a2766">pruicssHandle</a> = gPruIcss0Handle,</div>
<div class="line">                                .transferCallbackFxn = &amp;PRU_IPC_Isr,</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    gPruIpc0Handle = <a class="code" href="group__DRV__PRU__IPC__MODULE.html#gaf8db5f54464b6defa5878970ba4a8e89">PRU_IPC_open</a>(CONFIG_PRU_IPC0, &amp;pruIpcparams);</div>
<div class="line">    <a class="code" href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a>(gPruIpc0Handle != NULL);</div>
</div><!-- fragment --><p> Transfer data </p><div class="fragment"><div class="line">    <span class="comment">/* Receive Data from PRU core */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRU__IPC__MODULE.html#ga231deb3038ddf9b6092656081bf13825">PRU_IPC_getData</a>(gPruIpc0Handle, samples);</div>
<div class="line">    <span class="comment">/* Send Data to PRU core */</span></div>
<div class="line">    <a class="code" href="group__DRV__PRU__IPC__MODULE.html#gad2fc60554f7494a5b55b10162ee6c540">PRU_IPC_sendData</a>(gPruIpc0Handle, samples);</div>
</div><!-- fragment --><p>Usage on PRU Firmware Side: </p><div class="fragment"><div class="line">m_pru_ipc_init      R0.b0           ; Initializes PRU IPC paramenters, use R0.b0 register only</div>
<div class="line">ldi                 R1.b0, &amp;R3      ; Starting memory address of registers to send</div>
<div class="line">m_pru_ipc_send      R1.b0, R3, R0.b0, PRU_IPC_RX_INTR_ENABLE, PRU_IPC_RX_EVENT  ; Send data to shared memory</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2160"></a>
API</h1>
<p><a class="el" href="group__DRV__PRU__IPC__MODULE.html">APIs for PRU IPC: R5F-PRU communication</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div class="ttc" id="agroup__DRV__PRU__IPC__MODULE_html_gad2fc60554f7494a5b55b10162ee6c540"><div class="ttname"><a href="group__DRV__PRU__IPC__MODULE.html#gad2fc60554f7494a5b55b10162ee6c540">PRU_IPC_sendData</a></div><div class="ttdeci">int32_t PRU_IPC_sendData(PRU_IPC_Handle handle, void *container)</div><div class="ttdoc">Send/Write data to the configured shared memory (generates interrupt to PRU if it is enabled)</div></div>
<div class="ttc" id="agroup__DRV__PRU__IPC__MODULE_html_ga231deb3038ddf9b6092656081bf13825"><div class="ttname"><a href="group__DRV__PRU__IPC__MODULE.html#ga231deb3038ddf9b6092656081bf13825">PRU_IPC_getData</a></div><div class="ttdeci">int32_t PRU_IPC_getData(PRU_IPC_Handle handle, void *container)</div><div class="ttdoc">Reads the data from the configured shared memory.</div></div>
<div class="ttc" id="agroup__DRV__PRU__IPC__MODULE_html_gaf8db5f54464b6defa5878970ba4a8e89"><div class="ttname"><a href="group__DRV__PRU__IPC__MODULE.html#gaf8db5f54464b6defa5878970ba4a8e89">PRU_IPC_open</a></div><div class="ttdeci">PRU_IPC_Handle PRU_IPC_open(uint32_t idx, PRU_IPC_Params *params)</div><div class="ttdoc">To initialize and configure PRU_IPC instance.</div></div>
<div class="ttc" id="astructPRU__IPC__Params_html"><div class="ttname"><a href="structPRU__IPC__Params.html">PRU_IPC_Params</a></div><div class="ttdef"><b>Definition:</b> pru_ipc.h:107</div></div>
<div class="ttc" id="astructPRU__IPC__Params_html_ac13215b71f32f013bc1cf0cc326a2766"><div class="ttname"><a href="structPRU__IPC__Params.html#ac13215b71f32f013bc1cf0cc326a2766">PRU_IPC_Params::pruicssHandle</a></div><div class="ttdeci">PRUICSS_Handle pruicssHandle</div><div class="ttdef"><b>Definition:</b> pru_ipc.h:109</div></div>
<div class="ttc" id="agroup__KERNEL__DPL__DEBUG_html_ga552e9055ca7eab5fe6c224c6cd5a9d4c"><div class="ttname"><a href="group__KERNEL__DPL__DEBUG.html#ga552e9055ca7eab5fe6c224c6cd5a9d4c">DebugP_assert</a></div><div class="ttdeci">#define DebugP_assert(expression)</div><div class="ttdoc">Function to call for assert check.</div><div class="ttdef"><b>Definition:</b> DebugP.h:177</div></div>
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
