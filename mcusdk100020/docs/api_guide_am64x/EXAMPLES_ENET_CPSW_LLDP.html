<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Ethernet LLDP Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ENET_CPSW_LLDP.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ethernet LLDP Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1220">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1221">Supported Combinations</a><ul><li class="level2"><a href="#autotoc_md1222">Prerequisites</a></li>
<li class="level2"><a href="#autotoc_md1223">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1224">HW Setup</a></li>
<li class="level2"><a href="#autotoc_md1225">Create a network between EVM and host PC</a></li>
<li class="level2"><a href="#autotoc_md1226">Run the example</a></li>
<li class="level2"><a href="#autotoc_md1227">LLDP verification</a><ul><li class="level3"><a href="#autotoc_md1228">Verification #1 LLDPDU Tx interval and LLDPDU content (per one dest-mac-address)</a></li>
<li class="level3"><a href="#autotoc_md1229">Verification #2 Fast TX in case of new neighbor exist (per one dest-mac-address)</a></li>
<li class="level3"><a href="#autotoc_md1230">Verification #3 Delete neighbor info in case of Receiving LLDP shutdown (per one dest-mac-address)</a></li>
<li class="level3"><a href="#autotoc_md1231">Verification #4 Detected Neighbor info change (per one dest-mac-address)</a></li>
<li class="level3"><a href="#autotoc_md1232">Verification #5 Multiple Destination MAC addresses</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1233">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_cpsw_lldp_example"></a></p>
<h1><a class="anchor" id="autotoc_md1220"></a>
Introduction</h1>
<p>This ethernet LLDP example illustrates the usage of LLDP IEEE 802.1AB stack with CPSW peripheral.</p>
<p>In this example, the DUT MAC port is connected to a neighbor PC which also have opensource lldp agent. Yang based configuration is also supported. Currently File System is not supported, will be added in future releases.</p>
<p>See also :<a class="el" href="ENET_CPSW_LLDP.html">Ethernet LLDP Stack - API and Integration Guide</a></p>
<h1><a class="anchor" id="autotoc_md1221"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/networking/tsn/lldp_cpsw_app   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md1222"></a>
Prerequisites</h2>
<ul>
<li>EVM Board</li>
<li>Cat6 ethernet cable</li>
<li>PC with Linux Ubuntu OS with wireshark, docker installed</li>
<li>The LLDP opensource <code><a href="https://github.com/lldpd/lldpd">https://github.com/lldpd/lldpd</a></code> can be installed follow the guideline. But a quick start can be using docker: <div class="fragment"><div class="line">docker run --rm --net=host --uts=host \</div>
<div class="line">           -v /etc/os-release:/etc/os-release \</div>
<div class="line">           --cap-add=NET_RAW --cap-add=NET_ADMIN \</div>
<div class="line">           --name lldpd \</div>
<div class="line">           ghcr.io/lldpd/lldpd:latest</div>
</div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="autotoc_md1223"></a>
Build the example</h2>
<p>Refer <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP.html">Ethernet TSN gPTP Examples</a> to build the lldp example.</p>
<h2><a class="anchor" id="autotoc_md1224"></a>
HW Setup</h2>
<p>Refer <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP.html">Ethernet TSN gPTP Examples</a> for HW Setup.</p>
<h2><a class="anchor" id="autotoc_md1225"></a>
Create a network between EVM and host PC</h2>
<p>EVM and PC has to connected directly as shown below using CAT6 or CAT5 cable  <style>div.image img[src="gptp_topology_evm_pc.png"]{width:30%}</style> </p><div class="image">
<img src="gptp_topology_evm_pc.png" alt=""/>
<div class="caption">
Local network between PC and EVM</div></div>
<p>PORT1 instead of PORT0 on EVM can be used as well.</p>
<h2><a class="anchor" id="autotoc_md1226"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run again, a CPU power-cycle is MUST</dd></dl>
<p>Refer :<a class="el" href="ENET_CPSW_LLDP.html">Ethernet LLDP Stack - API and Integration Guide</a> for how to configure LLDP parameters.</p>
<h2><a class="anchor" id="autotoc_md1227"></a>
LLDP verification</h2>
<h3><a class="anchor" id="autotoc_md1228"></a>
Verification #1 LLDPDU Tx interval and LLDPDU content (per one dest-mac-address)</h3>
<p>With default setting </p><div class="fragment"><div class="line">{&quot;message-tx-interval&quot; , &quot;30&quot;},</div>
</div><!-- fragment --><p>Capture LLDPDU via wireshark and confirm the TX interval is around 30s  <style>div.image img[src="lldp_tx_interval.png"]{width:100%}</style> </p><div class="image">
<img src="lldp_tx_interval.png" alt=""/>
<div class="caption">
LLDP TX Interval</div></div>
<p>Capture LLDPDU via wireshark and confirm the LLDPDU content is match with configuration params in <code>lldp_init.c</code>  <style>div.image img[src="lldpdu_content.png"]{width:60%}</style> </p><div class="image">
<img src="lldpdu_content.png" alt=""/>
<div class="caption">
LLDPDU Content</div></div>
<h3><a class="anchor" id="autotoc_md1229"></a>
Verification #2 Fast TX in case of new neighbor exist (per one dest-mac-address)</h3>
<p>On Linux PC, start opensource LLDP application by: </p><div class="fragment"><div class="line">docker run --rm --net=host --uts=host \</div>
<div class="line">           -v /etc/os-release:/etc/os-release \</div>
<div class="line">           --cap-add=NET_RAW --cap-add=NET_ADMIN \</div>
<div class="line">           --name lldpd \</div>
<div class="line">           ghcr.io/lldpd/lldpd:latest</div>
</div><!-- fragment --><p>With default setting </p><div class="fragment"><div class="line">{&quot;message-fast-tx&quot; , &quot;1&quot;},</div>
<div class="line">{&quot;tx-fast-init&quot; , &quot;2&quot;},</div>
</div><!-- fragment --><p>Capture LLDPDU via wireshark and confirm after receive Linux PC LLDPDU, the DUT process fast tx flow by one TX LLDPDU immediately, and follow up by two (tx-fast-init) more LLDPDUs, with one second interval (message-fast-tx).</p>
<p> <style>div.image img[src="fast_tx_flow.png"]{width:100%}</style> </p><div class="image">
<img src="fast_tx_flow.png" alt=""/>
<div class="caption">
LLDPDU Fast TX Flow</div></div>
<p>After receive next LLDPDU from Linux PC, no more fast tx flow happened on DUT side.</p>
<h3><a class="anchor" id="autotoc_md1230"></a>
Verification #3 Delete neighbor info in case of Receiving LLDP shutdown (per one dest-mac-address)</h3>
<p>Continue 2nd verification, then turn OFF LLDPDU by <code>Ctrl + C</code> in Linux PC docker command. Verify DUT can detect and delete correct neighbor info include Port and Chassis ID.</p>
<p>DUT log </p><div class="fragment"><div class="line">INF:lldp:collect_ttl_info: Recv SHUTDOWN LLDPDU TTL=[0]</div>
<div class="line">INF:lldp:tilld0: Process shutdown for existed neighbor:</div>
<div class="line">INF:lldp:chassis id: bc-5f-f4-73-e5-5a</div>
<div class="line">INF:lldp:port id:    1c-fd-08-72-59-61</div>
</div><!-- fragment --><p>User can rerun 2nd verification and confirm Fast TX flow happen again.</p>
<h3><a class="anchor" id="autotoc_md1231"></a>
Verification #4 Detected Neighbor info change (per one dest-mac-address)</h3>
<p>On Linux PC side, change port description of corresponding port which is connect to DUT. In this example, enp3s0 is used. </p><div class="fragment"><div class="line">docker exec lldpd lldpcli configure port enp3s0 lldp portdescription xxxxxxx</div>
</div><!-- fragment --><p>DUT log </p><div class="fragment"><div class="line">INF:lldp:is_remote_system_data_change: Detected port desc changed</div>
<div class="line">INF:lldp:tilld0: Got updated for neighbor [TTL=120]:</div>
<div class="line">INF:lldp:chassis id: bc-5f-f4-73-e5-5a</div>
<div class="line">INF:lldp:port id:    1c-fd-08-72-59-61</div>
<div class="line">INF:lldp:update_remote_system_data: changed port_desc [enp3s0-&gt; xxxxxxx]</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md1232"></a>
Verification #5 Multiple Destination MAC addresses</h3>
<p>Configure 3 message-tx-interval values differently each other, like below:</p>
<div class="fragment"><div class="line">{</div>
<div class="line">.dest_mac = &quot;01-80-c2-00-00-0e&quot;,</div>
<div class="line">    {&quot;message-tx-interval&quot; , &quot;30&quot;},</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">.dest_mac = &quot;01-80-c2-00-00-03&quot;,</div>
<div class="line">    {&quot;message-tx-interval&quot; , &quot;20&quot;},</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">{</div>
<div class="line">.dest_mac = &quot;01-80-c2-00-00-00&quot;,</div>
<div class="line">    {&quot;message-tx-interval&quot; , &quot;25&quot;},</div>
<div class="line">}</div>
</div><!-- fragment --><p>Capture wireshark and verify the tx interval flow for:</p><ul>
<li>Nearest bridge 01-80-C2-00-00-0E (LLDP Multicast) is 30s</li>
<li>Nearest non-TPMR bridge 01-80-C2-00-00-03 is 20s</li>
<li>Nearest Customer Bridge (Spanning-tree-(for-bridges)_00) 01-80-C2-00-00-00 is 25s</li>
</ul>
<p> <style>div.image img[src="lldp_multiple_dest_mac.png"]{width:100%}</style> </p><div class="image">
<img src="lldp_multiple_dest_mac.png" alt=""/>
<div class="caption">
LLDP Multiple Destination MAC Addresses</div></div>
<p>Repeat verification #1 -&gt; #4 (The LLDP opensource is using Nearest bridge 01-80-C2-00-00-0E as destination MAC address) and confirm only Nearest bridge Dest MAC address in DUT takes effect.</p>
<h1><a class="anchor" id="autotoc_md1233"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> | <a class="el" href="ENET_CPSW_LLDP.html">Ethernet LLDP Stack - API and Integration Guide</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
