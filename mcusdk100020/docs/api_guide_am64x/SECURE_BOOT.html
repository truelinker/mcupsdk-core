<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Enabling Secure Boot</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('SECURE_BOOT.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enabling Secure Boot </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md183">Secure Devices and Secure Boot: An Introduction</a></li>
<li class="level1"><a href="#autotoc_md184">Secure Boot Process</a></li>
<li class="level1"><a href="#autotoc_md185">Secure Boot Support in SDK</a><ul><li class="level2"><a href="#autotoc_md186">Device configuration file</a></li>
<li class="level2"><a href="#autotoc_md187">Signing tool</a></li>
<li class="level2"><a href="#autotoc_md188">Generating Secure Boot Image</a><ul><li class="level3"><a href="#autotoc_md189">SBL Image Generation</a></li>
<li class="level3"><a href="#autotoc_md190">Signing the HSM Runtime binary (SYSFW)</a></li>
<li class="level3"><a href="#autotoc_md191">Secure application image Generation</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md192">Limitations in Secure Boot</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_developer_guides_secure_boot"></a></p>
<h1><a class="anchor" id="autotoc_md183"></a>
Secure Devices and Secure Boot: An Introduction</h1>
<p>To put it simply, <b>secure boot</b> refers to booting application images in a secure way. Secure boot is a feature/service available in <b>secure devices</b>.</p>
<p>Out of the device types <b>GP</b> and <b>HS</b>, HS device type can do secure boot. In secure devices there are two subtypes:</p>
<ol type="1">
<li>Field Securable (FS)</li>
<li>Security Enforced (SE)</li>
</ol>
<p>HS device type have FS and SE subtypes. Out of the two subtypes, FS and SE, this guide talks about secure boot in an <b>HS-SE</b> device. If the secure device received is an <b>HS-FS</b> subtype, it needs to be converted to an HS-SE variant with the customer keys burnt into the device eFUSEs. This is done using a special piece of software called an OTP keywriter. Keywriter documentation is out of scope for this guide.</p>
<h1><a class="anchor" id="autotoc_md184"></a>
Secure Boot Process</h1>
<p>Secure boot process, like the normal boot, consists of two stages - ROM loading and SBL loading. ROM loading is when the boot ROM loads the HSM runtime binary onto the HSM core, and the signed SBL binary into the primary boot core, which in most cases is an ARM Cortex R5F. SBL loading is when the SBL reads the signed application image from a boot media, authenticates it, decrypts it, and boots it. Here we describe how the secure process takes place in an HS-SE device.</p>
<dl class="section note"><dt>Note</dt><dd>In AM243x/AM64x devices, the HSM runtime binary mentioned is the System Firmware (SYSFW) and HSM core is the DMSC Cortex M3 core. Hereafter for generality sake we'll use the terms 'HSMRt' and 'HSM core' but understand that for AM64x/AM243x this means the SYSFW and Cortex M3 core.</dd></dl>
<h1><a class="anchor" id="autotoc_md185"></a>
Secure Boot Support in SDK</h1>
<h2><a class="anchor" id="autotoc_md186"></a>
Device configuration file</h2>
<p>To make the secure/non-secure differences seamless for the user, a configuration file is provided at <code>${SDK_INSTALL_PATH}/devconfig/devconfig.mak</code>. In this configuration file, you can set certain options like the device type, keys to be used for signing and encryption etc. By default they will point to the dummy customer MPKs and MEKs but if you're using a production device with your own keys, please change the paths here to point to the right key files. Configuration of this file is currently manual, this will be made configurable by a GUI in an upcoming release.</p>
<p>The devconfig.mak file looks something like this:</p>
<div class="fragment"><div class="line"># Device type (HS/GP)</div>
<div class="line">DEVICE_TYPE?=GP</div>
<div class="line"> </div>
<div class="line"># Path to the signing tools, keys etc</div>
<div class="line">SIGNING_TOOL_PATH=$(MCU_PLUS_SDK_PATH)/tools/boot/signing</div>
<div class="line"> </div>
<div class="line"># Encryption option (yes/no)</div>
<div class="line">ENC_ENABLED?=no</div>
<div class="line"> </div>
<div class="line"># Generic macros to be used depending on the device type</div>
<div class="line">APP_SIGNING_KEY=</div>
<div class="line">APP_ENCRYPTION_KEY=</div>
<div class="line"> </div>
<div class="line">ifeq ($(DEVICE_TYPE),HS)</div>
<div class="line">    APP_SIGNING_KEY=$(CUST_MPK)</div>
<div class="line">    APP_ENCRYPTION_KEY=$(CUST_MEK)</div>
<div class="line">else</div>
<div class="line">    APP_SIGNING_KEY=$(ROM_DEGENERATE_KEY)</div>
<div class="line">endif</div>
</div><!-- fragment --><p>This file will be included in all example makefiles</p>
<h2><a class="anchor" id="autotoc_md187"></a>
Signing tool</h2>
<p>For signing the binaries, two different scripts are used:</p>
<ol type="1">
<li>ROM signing script - This is a python script used for signing the SBL. The x509 certificate template used in this script is expected by the ROM.</li>
<li><p class="startli">Application signing script - This is a python script used for signing the application image. The x509 certificate template used in this script is expected by the HSMRt.</p>
<p class="startli">For more details on the usage of the script, see <a class="el" href="TOOLS_BOOT.html#TOOLS_BOOT_SIGNING">Signing Scripts</a></p>
</li>
</ol>
<h2><a class="anchor" id="autotoc_md188"></a>
Generating Secure Boot Image</h2>
<h3><a class="anchor" id="autotoc_md189"></a>
SBL Image Generation</h3>
<p>In AM64x/AM243x devices, a combined boot method is employed, by virtue of which the SBL, SYSFW and the SYSFW-BoardConfig are combined and signed with the same certificate. This is built into the make system of the SBL applications in the SDK - SBL_UART, SBL_OSPI, SBL_SD, SBL_NULL, etc. So whenever an SBL application is built, the loadable <code>*.tiimage</code> will be a concatenation of the x509 certificate, SBL binary, SYSFW binary and the boardcfg binary blob. In case of HS devices, the SYSFW inner certificate will also be concatenated.</p>
<p>SBL and HSMRt are signed via Root of trust Keys i.e. SMPK (if keyrev = 1) or BMPK (if keyrev = 2). MCU+ SDK is only tested with TI-Dummy Keys. Users are expected to generate their own set of keys and use the same for production. This is supposed to be used only with the devices with the same dummy customer MPK burnt into the eFUSEes. If the SDK is supposed to be used with a production/development device with actual customer MPKs burnt into the device, please replace the file at ${SDK_INSTALL_PATH}/tools/boot/signing/custMpk_${SOC}.pem. This is true for also the encryption key used, which can also be found at ${SDK_INSTALL_PATH}/tools/boot/signing/custMek_${SOC}.txt. Whenever any SBL is built, it will be signed with dummy customer MPK, and the signed image generated will have an extension of <code>*.hs.tiimage</code>.</p>
<p>For more information, please refer to the OTP Keywriter Documentation.</p>
<p>There is no extra step required other than making sure that the MPK used is indeed the one burnt into the eFUSEs.</p>
<dl class="section note"><dt>Note</dt><dd>We have enabled full debug while signing the ROM image. This is intentional as this is helpful for debug. Once moved from development to production please remove this option from the makefile. For more details see <a class="el" href="TOOLS_BOOT.html#TOOLS_BOOT_SIGNING">Signing Scripts</a></dd></dl>
<h3><a class="anchor" id="autotoc_md190"></a>
Signing the HSM Runtime binary (SYSFW)</h3>
<p>As mentioned above, since we follow a combined boot method, SYSFW and SBL is signed with the same certificate using the same key. In case of a GP device this will be a degenerate key for easy parsing from ROM. In the case of an HS device, SYSFW will be already signed with TI MPK (and encrypted). This is then countersigned again with dummy customer MPK during the combined image generation process.</p>
<h3><a class="anchor" id="autotoc_md191"></a>
Secure application image Generation</h3>
<p>Depending on the options given in the device configuration file (<code>devconfig.mak</code> mentioned above), appimage is generated for HS devices. If encryption is enabled in the configuration file, the binary will be first encrypted with the key specified and then the certificate will be generated using the customer MPK specified. If the device type is set as HS in the configuration file, nothing extra needs to be done for the appimage generation. The final <code>*.appimage.hs</code> file generated would be signed with customer MPK (and encrypted with customer MEK if that option is selected).</p>
<p>To dig into the details of the process, one can refer to <a href="https://software-dl.ti.com/tisci/esd/latest/6_topic_user_guides/secure_boot_signing.html">https://software-dl.ti.com/tisci/esd/latest/6_topic_user_guides/secure_boot_signing.html</a></p>
<p>The SBL doesn't have innate abilities to do the image integrity check, or verify the SHA512 of the application image. It relies on SYSFW for this. The image is stored in a readable memory and a pointer to the start of the image is passed to the HSMRt with other details like load address, type of authentication etc.</p>
<p>For more information regarding the authentication request, please refer to <a href="http://downloads.ti.com/tisci/esd/latest/2_tisci_msgs/security/PROC_BOOT.html#proc-boot-authenticate-image-and-configure-processor">http://downloads.ti.com/tisci/esd/latest/2_tisci_msgs/security/PROC_BOOT.html#proc-boot-authenticate-image-and-configure-processor</a></p>
<h1><a class="anchor" id="autotoc_md192"></a>
Limitations in Secure Boot</h1>
<ul>
<li><b>XIP boot</b> : Secure boot is yet to be supported for XIP applications. This is due to the fact that the XIP sections are loaded before the SBL parses the other sections. Secure boot of XIP applications will be made available in an upcoming release.</li>
<li><b>Encryption of application image not possible in SBL OSPI</b> : In other bootloaders like UART and SD, application image can be encrypted using the <code>ENC_ENABLED</code> option in the devconfig.mak. But this is not possible when you load the image using SBL OSPI. This is due to the fact that HSM does an in-place authentication and decryption of the image and we load the image directly from the FLASH memory in case of SBL OSPI. FLASH memory, as you would know is most often not directly writable. Due to this limitation not being taken care in the HSM, we can do decryption of images only in the case where the image resides in a volatile RAM-like memory. That is MSMC or DDR. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
