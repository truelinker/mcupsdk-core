<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Enet VLAN ICSSG Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ENET_VLAN_ICSSG.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enet VLAN ICSSG Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1326">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1327">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1328">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1329">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1330">HW Setup</a><ul><li class="level3"><a href="#autotoc_md1331">AM64X-EVM</a><ul><li class="level4"><a href="#autotoc_md1332">For ICSSG based example</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1333">Run the example</a></li>
<li class="level2"><a href="#autotoc_md1334">Sample output for VLAN ICSSG example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1335">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_vlan_icssg"></a></p>
<h1><a class="anchor" id="autotoc_md1326"></a>
Introduction</h1>
<p>This Enet VLAN icssg example demonstrates UNH-IOL VLAN conformance and FDB conformance using Enet with ICSSG peripheral.</p>
<p>On AM64X, we can do ethernet based communication using ICSSG HW Mechanism</p>
<ul>
<li>PRU firmware based Ethernet Switch and Dual MAC implementation</li>
<li>This HW can be used with industrial communication protocols as well</li>
</ul>
<p>This example do below:</p><ul>
<li>Target-side application running on a Cortex R5F core.<ul>
<li>Application receives the packet, copies the payload into a new packet which is then sent back.</li>
<li>The application has a menu to select main test cases or sub test cases which are under main test cases.</li>
<li>VLAN test, FDB test, UTILS test, VLAN Aware/Unaware mode and Unit test default settings are in main test cases in the menu and there are many sub test cases under VLAN and FDB tests which are available at UNH-IOL conformance tests to verify the standard conformance criteria.</li>
<li>UTILS test is to print/reset the statistics, packet receive count, generate Unicast traffic and etc. This menu along with application logs are implemented via UART.</li>
</ul>
</li>
<li>Host-side functionality<ul>
<li>Software applications like Colasoft Pkt Builder or packETH tool could be used to generate and send packets, Wireshark can be used to receive and verify packet contents</li>
</ul>
</li>
<li>The data path enabled in this example is as follows:<ul>
<li>Host side (PC) application sends a packet to MAC port.</li>
<li>Based on Switch mode or Dual-EMAC mode the data flow will differ.</li>
<li>In Switch mode:<ul>
<li>If packet is non directed unicast(UC) packet, it will be only forwarded.</li>
<li>If packet is directed unicast(UC) packet, it will be sent only to target application.</li>
<li>If packet is multicast(MC) or broadcast(BC) packet, it will be forwarded as well as sent to target application.</li>
</ul>
</li>
<li>In Dual-mac mode:<ul>
<li>If packet is Non directed unicast(UC) packet it will be dropped.</li>
<li>If packet is directed unicast(UC) or multicast(MC) or broadcast(BC) packet, it will be sent to target application.</li>
<li>Currently to test both MAC ports simultaneously in Dual-MAC mode it requires additional enet lld(UDMA channel allocation) changes.</li>
</ul>
</li>
<li>Based on test case selction and Filtering options DUT will decide to forward the packet or to drop the packet.</li>
<li>Target side application receives the packet, updates the MAC addresses in the Layer-2 header and sends the packet back.</li>
<li>Application like Wireshark (PC) receives the packet and can be seen in the capture window.</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1327"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Icssg Instance  </td><td class="markdownTableBodyNone">ICSSG1   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/networking/enet_vlan_icssg   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1328"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1329"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a href="@VAR_MCU_SDK_DOCS_PATH/CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a href="@VAR_MCU_SDK_DOCS_PATH/MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1330"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a href="@VAR_MCU_SDK_DOCS_PATH/EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h3><a class="anchor" id="autotoc_md1331"></a>
AM64X-EVM</h3>
<h4><a class="anchor" id="autotoc_md1332"></a>
For ICSSG based example</h4>
<ul>
<li>Connect two ethernet cables to the EVM from two host PC's as shown below</li>
</ul>
<p> <style>div.image img[src="am64x_evm_lwip_example_01.png"]{width:30%}</style> </p><div class="image">
<img src="am64x_evm_lwip_example_01.png" alt=""/>
<div class="caption">
Ethernet cable for ICSS based ethernet</div></div>
<h2><a class="anchor" id="autotoc_md1333"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run again, a CPU power-cycle is MUST</dd></dl>
<ul>
<li>Launch a CCS debug session and run the example executable, see <a href="@VAR_MCU_SDK_DOCS_PATH/CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>You will see logs in the UART terminal as shown in the next section.</li>
<li>Select the Unit test default settings test case(5) from main menu and configure switch in VLAN Aware mode by selecting testcase number 4 and provide input as 1 to enable VLAN aware mode and 0 for VLAN unaware mode.</li>
<li>We can start sending packets from Colasoft Pkt Builder or packETH tool and capture the packets in Wireshark.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1334"></a>
Sample output for VLAN ICSSG example</h2>
<div class="fragment"><div class="line">================================</div>
<div class="line">      ENET ICSSG UNIT TEST</div>
<div class="line">================================</div>
<div class="line"> </div>
<div class="line">Init all peripheral clocks</div>
<div class="line">----------------------------------------------</div>
<div class="line">Enabling clocks!</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line"> </div>
<div class="line">Init  configs EnetType:2, InstId :1</div>
<div class="line">----------------------------------------------</div>
<div class="line">icssg1: Open port 1</div>
<div class="line">EnetPhy_bindDriver:</div>
<div class="line">icssg1: Open port 2</div>
<div class="line">EnetPhy_bindDriver:</div>
<div class="line">PHY 3 is alive</div>
<div class="line">PHY 15 is alive</div>
<div class="line"> </div>
<div class="line">Open all peripherals</div>
<div class="line">----------------------------------------------</div>
<div class="line">icssg1: Register async IOCTL callback</div>
<div class="line">icssg1: Register TX timestamp callback</div>
<div class="line"> </div>
<div class="line">Attach core id 1 on all peripherals</div>
<div class="line">----------------------------------------------</div>
<div class="line">icssg1: Attach core</div>
<div class="line"> </div>
<div class="line">Create RX tasks</div>
<div class="line">----------------------------------------------</div>
<div class="line">icssg1: Create RX task</div>
<div class="line">icssg1: Waiting for link up...</div>
<div class="line"> </div>
<div class="line">***************************************************</div>
<div class="line">                UNIT TEST MENU</div>
<div class="line">***************************************************</div>
<div class="line">1.  TC_VLAN_testing</div>
<div class="line">2.  TC_FDB_testing</div>
<div class="line">3.  UTILS_testing</div>
<div class="line">4.  TC_configure_vlan_aware_unaware</div>
<div class="line">5.  setup_unit_test_default_settings</div>
<div class="line"> </div>
<div class="line">Test case id: Icssg_handleLinkUp:</div>
<div class="line">icssg1: Port 1 link is up</div>
<div class="line">icssg1: Set port state to &#39;Forward&#39;</div>
<div class="line">icssg1: Async IOCTL completed</div>
<div class="line">icssg1: Async IOCTL completed</div>
<div class="line">Icssg_handleLinkUp:</div>
<div class="line">icssg1: Port 2 link is up</div>
<div class="line">icssg1: Set port state to &#39;Forward&#39;</div>
<div class="line">icssg1: Async IOCTL completed</div>
<div class="line">icssg1: Async IOCTL completed</div>
<div class="line">icssg1: Open DMA</div>
<div class="line">initQs() txFreePktInfoQ initialized with 8 pkts</div>
<div class="line">icssg1: Set MAC addr: 70:ff:76:1d:92:c1</div>
<div class="line">icssg1: MAC port addr: 70:ff:76:1d:92:c1</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"> Invalid test case please select valid test case</div>
<div class="line"> </div>
<div class="line">***************************************************</div>
<div class="line">                UNIT TEST MENU</div>
<div class="line">***************************************************</div>
<div class="line">1.  TC_VLAN_testing</div>
<div class="line">2.  TC_FDB_testing</div>
<div class="line">3.  UTILS_testing</div>
<div class="line">4.  TC_configure_vlan_aware_unaware</div>
<div class="line">5.  setup_unit_test_default_settings</div>
<div class="line"> </div>
<div class="line">Test case id: 3</div>
<div class="line">In UTILS related testing...</div>
<div class="line">Please select Test no to choose particular test case to execute</div>
<div class="line">1.  UTILS_display_icssg_hw_consolidated_statistics</div>
<div class="line">2.  UTILS_clear_icssg_hw_consolidated_statistics</div>
<div class="line">3.  UTILS_NRT_add_del_mac_fdb_entry</div>
<div class="line">4.  UTILS_NRT_cofig_port_state</div>
<div class="line">5.  UTILS_NRT_add_fid_vid_entry for PORT1 and PORT2</div>
<div class="line">6.  UTILS_config_PVID</div>
<div class="line">7.  UTILS_get_receive_packet_count</div>
<div class="line">8.  UTILS_clear_receive_packet_count</div>
<div class="line">9.  UTILS_Transmit_UC_packets</div>
<div class="line">1</div>
<div class="line">*************************************************************************</div>
<div class="line">HW STAT PARAM                   PORT1           PORT2</div>
<div class="line">*************************************************************************</div>
<div class="line"> </div>
<div class="line">Print statistics</div>
<div class="line">----------------------------------------------</div>
<div class="line"> </div>
<div class="line"> icssg1 statistics</div>
<div class="line">--------------------------------</div>
<div class="line">  rxGoodFrames            = 76991</div>
<div class="line">  rxClass8                = 76991</div>
<div class="line">  rxClass9                = 76991</div>
<div class="line">  rxBucket2SizedFrame     = 65535</div>
<div class="line">  rxTotalByte             = 9854848</div>
<div class="line">  rxTxTotalByte           = 20325624</div>
<div class="line">  txGoodFrame             = 468106</div>
<div class="line">  txBucket3SizedFrame     = 65535</div>
<div class="line">  txTotalByte             = 63662416</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Print statistics</div>
<div class="line">----------------------------------------------</div>
<div class="line"> </div>
<div class="line"> icssg1 statistics</div>
<div class="line">--------------------------------</div>
<div class="line">  rxGoodFrames            = 468106</div>
<div class="line">  rxClass8                = 468106</div>
<div class="line">  rxClass9                = 468106</div>
<div class="line">  rxBucket2SizedFrame     = 65535</div>
<div class="line">  rxTotalByte             = 59917568</div>
<div class="line">  rxTxTotalByte           = 123579984</div>
<div class="line">  txGoodFrame             = 76991</div>
<div class="line">  txBucket3SizedFrame     = 65535</div>
<div class="line">  txTotalByte             = 10470776</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">Test UTILS_display_icssg_hw_consolidated_statistics run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">*****************************************************</div>
<div class="line">        TEST UTILITY EXECUTION SUMMARY</div>
<div class="line">*****************************************************</div>
<div class="line"> </div>
<div class="line">Test UTILS_testing run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">***************************************************</div>
<div class="line">                UNIT TEST MENU</div>
<div class="line">***************************************************</div>
<div class="line">1.  TC_VLAN_testing</div>
<div class="line">2.  TC_FDB_testing</div>
<div class="line">3.  UTILS_testing</div>
<div class="line">4.  TC_configure_vlan_aware_unaware</div>
<div class="line">5.  setup_unit_test_default_settings</div>
<div class="line"> </div>
<div class="line">Test case id: 3</div>
<div class="line">In UTILS related testing...</div>
<div class="line">Please select Test no to choose particular test case to execute</div>
<div class="line">1.  UTILS_display_icssg_hw_consolidated_statistics</div>
<div class="line">2.  UTILS_clear_icssg_hw_consolidated_statistics</div>
<div class="line">3.  UTILS_NRT_add_del_mac_fdb_entry</div>
<div class="line">4.  UTILS_NRT_cofig_port_state</div>
<div class="line">5.  UTILS_NRT_add_fid_vid_entry for PORT1 and PORT2</div>
<div class="line">6.  UTILS_config_PVID</div>
<div class="line">7.  UTILS_get_receive_packet_count</div>
<div class="line">8.  UTILS_clear_receive_packet_count</div>
<div class="line">9.  UTILS_Transmit_UC_packets</div>
<div class="line">9</div>
<div class="line">Enter port number(PORT1 = 1 and PORT2 = 2) to start transmitting the packets:</div>
<div class="line">1</div>
<div class="line">Enter number of packets to transmit:</div>
<div class="line">100</div>
<div class="line"> </div>
<div class="line">Test UTILS_Transmit_UC_packets run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">*****************************************************</div>
<div class="line">        TEST UTILITY EXECUTION SUMMARY</div>
<div class="line">*****************************************************</div>
<div class="line"> </div>
<div class="line">Test UTILS_testing run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">***************************************************</div>
<div class="line">                UNIT TEST MENU</div>
<div class="line">***************************************************</div>
<div class="line">1.  TC_VLAN_testing</div>
<div class="line">2.  TC_FDB_testing</div>
<div class="line">3.  UTILS_testing</div>
<div class="line">4.  TC_configure_vlan_aware_unaware</div>
<div class="line">5.  setup_unit_test_default_settings</div>
<div class="line"> </div>
<div class="line">Test case id: 3</div>
<div class="line">In UTILS related testing...</div>
<div class="line">Please select Test no to choose particular test case to execute</div>
<div class="line">1.  UTILS_display_icssg_hw_consolidated_statistics</div>
<div class="line">2.  UTILS_clear_icssg_hw_consolidated_statistics</div>
<div class="line">3.  UTILS_NRT_add_del_mac_fdb_entry</div>
<div class="line">4.  UTILS_NRT_cofig_port_state</div>
<div class="line">5.  UTILS_NRT_add_fid_vid_entry for PORT1 and PORT2</div>
<div class="line">6.  UTILS_config_PVID</div>
<div class="line">7.  UTILS_get_receive_packet_count</div>
<div class="line">8.  UTILS_clear_receive_packet_count</div>
<div class="line">9.  UTILS_Transmit_UC_packets</div>
<div class="line">9</div>
<div class="line">Enter port number(PORT1 = 1 and PORT2 = 2) to start transmitting the packets:</div>
<div class="line">2</div>
<div class="line">Enter number of packets to transmit:</div>
<div class="line">100</div>
<div class="line"> </div>
<div class="line">Test UTILS_Transmit_UC_packets run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">*****************************************************</div>
<div class="line">        TEST UTILITY EXECUTION SUMMARY</div>
<div class="line">*****************************************************</div>
<div class="line"> </div>
<div class="line">Test UTILS_testing run successfully from DUT side...</div>
<div class="line"> </div>
<div class="line">***************************************************</div>
<div class="line">                UNIT TEST MENU</div>
<div class="line">***************************************************</div>
<div class="line">1.  TC_VLAN_testing</div>
<div class="line">2.  TC_FDB_testing</div>
<div class="line">3.  UTILS_testing</div>
<div class="line">4.  TC_configure_vlan_aware_unaware</div>
<div class="line">5.  setup_unit_test_default_settings</div>
<div class="line"> </div>
<div class="line">Test case id:</div>
</div><!-- fragment --><ul>
<li>On Wireshark we can see the packets received:</li>
</ul>
<p> <style>div.image img[src="layer2_icssg_example_wireshark_log.png"]{width:50%}</style> </p><div class="image">
<img src="layer2_icssg_example_wireshark_log.png" alt=""/>
<div class="caption">
Wireshark log for VLAN ICSSG Example</div></div>
<h1><a class="anchor" id="autotoc_md1335"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> <a class="el" href="ICSSG0_USAGE_GUIDE.html">Ethernet PRU_ICSSG instance-0 (PRU_ICSSG0) USAGE GUIDE</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
