<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Ethernet TSN and gPTP Stack - API and Integration Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('ENET_CPSW_TSN_GPTP.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Ethernet TSN and gPTP Stack - API and Integration Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md2024">Pre-requisites</a></li>
<li class="level1"><a href="#autotoc_md2025">Introduction</a></li>
<li class="level1"><a href="#autotoc_md2026">Demo and Examples</a></li>
<li class="level1"><a href="#autotoc_md2027">TSN Stack</a><ul><li class="level2"><a href="#autotoc_md2028">Compilation</a></li>
<li class="level2"><a href="#autotoc_md2029">Modules</a></li>
<li class="level2"><a href="#autotoc_md2030">Stack Initialization</a></li>
<li class="level2"><a href="#autotoc_md2031">Logging</a></li>
<li class="level2"><a href="#autotoc_md2032">Starting uniconf and gPTP</a></li>
<li class="level2"><a href="#autotoc_md2033">TSN Deinitialization</a></li>
<li class="level2"><a href="#autotoc_md2034">gPTP Multiple Domains</a></li>
<li class="level2"><a href="#autotoc_md2035">gPTP Shorter Sync Interval</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2036">Integration</a><ul><li class="level2"><a href="#autotoc_md2037">Source integration</a></li>
<li class="level2"><a href="#autotoc_md2038">Uniconf configuration</a></li>
<li class="level2"><a href="#autotoc_md2039">gPTP Yang Config Parameters</a></li>
<li class="level2"><a href="#autotoc_md2040">gPTP Non-Yang Config Parameters</a><ul><li class="level3"><a href="#autotoc_md2041">gPTP Performance optimization</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md2042">Limitations</a></li>
<li class="level1"><a href="#autotoc_md2043">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_components_networking_enet_cpsw_tsn_gptp_apiguide"></a></p>
<h1><a class="anchor" id="autotoc_md2024"></a>
Pre-requisites</h1>
<p>Reader are expected to have basic knowledge on below IEEE specifications</p><ul>
<li>Standard ethernet (IEEE 802.1)</li>
<li>Timing and Synchronization for Time-Sensitive Applications - gPTP (IEEE 802.1AS-2020)</li>
<li>Forwarding and Queuing Enhancements for Time-Sensitive Streams (IEEE 802.1Qav)</li>
<li>Enhancements for Scheduled Traffic (IEEE 802.1Qbv)</li>
<li>Frame Preemption (IEEE 802.1Qbu)</li>
</ul>
<h1><a class="anchor" id="autotoc_md2025"></a>
Introduction</h1>
<p>This guide is intended to enhance user's understanding of the TSN stack and provide guidance on how to seamlessly integrate TSN modules into their own applications.</p>
<h1><a class="anchor" id="autotoc_md2026"></a>
Demo and Examples</h1>
<p><a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_BRIDGE.html">Ethernet TSN CPSW gPTP Bridge Example</a> <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TR.html">Ethernet TSN CPSW gPTP TimeReceiver (gPTP Slave) Example</a> <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TT.html">Ethernet TSN CPSW gPTP TimeTransmitter (gPTP Master) Example</a></p>
<h1><a class="anchor" id="autotoc_md2027"></a>
TSN Stack</h1>
<h2><a class="anchor" id="autotoc_md2028"></a>
Compilation</h2>
<p>TSN stack library is pre-built in SDK and located in <code>&lt;mcu_plus_sdk&gt;/examples/networking/tsn</code> directory as .lib files. Any changes in the stack source code needs rebuild of library. In order to re-build the library, follow the below steps- </p><div class="fragment"><div class="line">cd  &lt;mcu_plus_sdk&gt;</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=debug libs-clean</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=release libs-clean</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=debug libs</div>
<div class="line">gmake DEVICE:=@VAR_SOC_NAME PROFILE:=release libs</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md2029"></a>
Modules</h2>
<p>The TSN Stack library is composed of the following source modules:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Module Name  </th><th class="markdownTableHeadNone">lcoation  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Unibase  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_unibase</code>  </td><td class="markdownTableBodyNone">Universal utility libraries that are platform-independent   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Combase  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_combase</code>  </td><td class="markdownTableBodyNone">Communication utility libraries that provide support for functions like sockets, mutexes, and semaphores   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Uniconf  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_uniconf</code>  </td><td class="markdownTableBodyNone">Universal configuration daemon for Yang, provides APIs for developing a client application which retreives/writes yang parameters from/to database   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">gPTP  </td><td class="markdownTableBodyNone"><code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn_gptp</code>  </td><td class="markdownTableBodyNone">Implementation of the IEEE 802.1 AS gptp protocol   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2030"></a>
Stack Initialization</h2>
<p>A reference example of the TSN stack initialization can be found in <code>&lt;mcu_plus_sdk&gt;/examples/networking/tsn/tsninit.c</code>. Prior to any module calls, it is necessary to initialize the unibase library once. This can be achieved by invoking the <code>EnetApp_initTsnByCfg()</code> function.</p>
<h2><a class="anchor" id="autotoc_md2031"></a>
Logging</h2>
<p>By default, TSN logs are directed to STDOUT using the fwrite function: <code>fwrite(str, 1, strlen(str), stdout);</code> However, it is possible to customize the log output by setting the <code>Logger_init(cfg-&gt;consoleOutCb)</code> callback during the initialization of the unibase library in the <code>EnetApp_initTsnByCfg()</code> function.</p>
<p>When a callback function is assigned to <code>consoleOutCb</code> it takes a significant amount of time to log to the output device, it is advisable to log to a buffer and utilize another task to log from the buffer to the desired output device. This approach helps to prevent log delays that could adversely affect the gPTP task, such as incorrect <em>Sync</em> and <em>FollowUp</em> intervals. The option to log to a buffer is supported when the <code>TSN_USE_LOG_BUFFER</code> macro is defined.</p>
<p>To enable specific log levels, you can modify the ub_log_initstr parameter in the <code>EnetApp_initTsnByCfg(</code>) function. There are eight log levels available:: </p><div class="fragment"><div class="line">UBL_NONE = 0</div>
<div class="line">UBL_FATAL = 1</div>
<div class="line">UBL_ERROR = 2</div>
<div class="line">UBL_WARN = 3</div>
<div class="line">UBL_INFO = 4</div>
<div class="line">UBL_INFOV = 5</div>
<div class="line">UBL_DEBUG = 6</div>
<div class="line">UBL_DEBUGV = 7</div>
</div><!-- fragment --><p>For example: <code>init_para.ub_log_initstr = "4,ubase:45,cbase:45,gptp:55,uconf:45";</code></p>
<p>In the above example, <code>uconf:45</code> signifies the following:</p>
<p><code>4 (INFO)</code>: Log level for printing to the console. <code>5 (INFOV)</code>: Log level for storing in internal memory (which can be dumped to a file).</p>
<p>Please note that enabling the DEBUG or DEBUGV level will result in a large number of logs being generated. If the log buffer is used, it may overflow, causing some logs to be lost.</p>
<p>The first '4' character in <code>"4,ubase...</code> represents the default log level applied to all modules.</p>
<h2><a class="anchor" id="autotoc_md2032"></a>
Starting uniconf and gPTP</h2>
<p>The gPTP functionality operates in a separate task, alongside the universal configuration daemon "uniconf". To start these tasks, use the <code>EnetApp_startTsn()</code> in tsninit.c as reference .</p>
<p>This function will start the uniconf and gPTP tasks.</p>
<h2><a class="anchor" id="autotoc_md2033"></a>
TSN Deinitialization</h2>
<p>To deinitialize the TSN modules, you can invoke the <code>EnetApp_stopTsn();</code> and <code>EnetApp_deInitTsn();</code> functions.</p>
<h2><a class="anchor" id="autotoc_md2034"></a>
gPTP Multiple Domains</h2>
<p>At the moment, our system supports two domains, but this feature is turned off by default. To turn on multiple domains, follow these steps:</p>
<ul>
<li>Set <code>#define GPTP_MAX_DOMAINS 2</code> in the <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_buildconf/sitara_buildconf.h</code> file</li>
<li>In the file <code>&lt;mcu_plus_sdk&gt;/examples/networking/tsn/gptp_init.c</code>, you will see the following settings are set: <div class="fragment"><div class="line">#if GPTP_MAX_DOMAINS == 2</div>
<div class="line">    {&quot;CMLDS_MODE&quot;, XL4_EXTMOD_XL4GPTP_CMLDS_MODE, 1},</div>
<div class="line">    {&quot;SECOND_DOMAIN_THIS_CLOCK&quot;, XL4_EXTMOD_XL4GPTP_SECOND_DOMAIN_THIS_CLOCK, 1}</div>
<div class="line">#endif</div>
</div><!-- fragment --></li>
</ul>
<p>This will activate the second domain in the gPTP system.</p>
<h2><a class="anchor" id="autotoc_md2035"></a>
gPTP Shorter Sync Interval</h2>
<p>By default, the gPTP Sync interval is set to 125 milliseconds. If you need a shorter Sync interval, you can adjust it by setting a specific value in the <code>sitara_buildconf.h</code> file:</p>
<div class="fragment"><div class="line">/* Interval timeout in nanoseconds used to generate timers in GPTP. </div>
<div class="line"> * Supported values are 125, 62.5, 31.25, 15.625 and 7.8125 milliseconds. */</div>
<div class="line">#define GPTPNET_INTERVAL_TIMEOUT_NSEC 15625000u</div>
</div><!-- fragment --><p><code>GPTPNET_INTERVAL_TIMEOUT_NSEC</code> must be equal to or less than the desired Sync interval time. For instance, if you want a Sync interval time of 31.25 milliseconds, set <code>GPTPNET_INTERVAL_TIMEOUT_NSEC</code> to 31.25, 15.625, or 7.8125 milliseconds. Be aware that decreasing <code>GPTPNET_INTERVAL_TIMEOUT_NSEC</code> will increase CPU load. Additionally, adjust the <code>log-sync-interval</code> in the standard yang config by referring to the <code>gptp_init.c</code> file. For example, to set the Sync interval to 31.25 milliseconds, set <code>log-sync-interval</code> to -5.</p>
<h1><a class="anchor" id="autotoc_md2036"></a>
Integration</h1>
<h2><a class="anchor" id="autotoc_md2037"></a>
Source integration</h2>
<p>To integrate the TSN stack into your application, follow these steps:</p>
<ul>
<li><p class="startli">Initialize Enet LLD and setup board dependencies. In the TSN example application, the initialization routines can be found at <code>&lt;mcu_plus_sdk&gt;/examples/networking/tsn/tsnapp_cpsw_main.c.c</code>, which can be used as reference.</p>
<p class="startli">The main functions related to EVM board initialization are:: </p><div class="fragment"><div class="line">EnetAppUtils_enableClocks();</div>
<div class="line">EnetApp_driverInit();</div>
<div class="line">EnetApp_driverOpen();</div>
<div class="line">...</div>
</div><!-- fragment --><p class="startli">These functions are responsible for configuring pinmux, GPIOs, etc., as well as providing the MAC port and PHY configuration parameters, which are board specific.</p>
</li>
<li>Before calling any TSN module APIs, ensure you initialize TSN by calling <code>EnetApp_initTsnByCfg()</code>.</li>
<li>Initialize the <em>combase</em> Ethernet device table as the following code snippet::</li>
</ul>
<div class="fragment"><div class="line">for (i = 0; i &lt; gEnetAppCfg.numMacPort; i++)</div>
<div class="line">{</div>
<div class="line">    snprintf(&amp;g_netdevices[i][0], CB_MAX_NETDEVNAME, &quot;tilld%d&quot;, i);</div>
<div class="line">    ethdevs[i].netdev = g_netdevices[i];</div>
<div class="line">    ethdevs[i].macport = gEnetAppCfg.macPorts[i];</div>
<div class="line">    memcpy(ethdevs[i].srcmac, gEnetAppCfg.macAddr, ENET_MAC_ADDR_LEN);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">cb_lld_init_devs_table(ethdevs, i, enetType, instId);</div>
</div><!-- fragment --><p>In the above code, the Ethernet device name and MAC port are required to create a virtual Ethernet device table that facilitates the conversion between the device name and the MAC port number.</p>
<p>In the above code, the Ethernet device name and MAC port are required to create a virtual Ethernet device table that facilitates the conversion between the device name and the MAC port number.</p>
<p>Please ensure that the <code>ethdevs[i].netdev</code> pointer points to a global memory location rather than a stack memory. The <em>combase</em> layer will reference this address instead of making a copy.</p>
<p>If the "ethdevs[i].srcmac" is either unset or set to all zeroes, the "combase" will allocate a source MAC address. If the user's application requires manual assignment of a source MAC address to the interface, please ensure to set the "ethdevs[i].srcmac" variable accordingly.</p>
<ul>
<li>To provide syscfg values to the TSN stack, you can use the <code><a class="el" href="group__lld__ethernet.html#ga1df9e6ac302f841bb59e48fc913f3984" title="This function sets the callback for updating LLD config parameters. It enables the user to update con...">cb_socket_set_lldcfg_update_cb()</a></code>` The parameter for this function is a callback function that updates the <a class="el" href="structcb__socket__lldcfg__update__t.html" title="Structure representing the cb_socket_lldcfg_update instance.">cb_socket_lldcfg_update_t</a> values.</li>
<li>Start the gPTP task by calling <code>EnetApp_startTsn()</code>. This will start the necessary threads for gPTP and uniconf. The uniconf, gPTP tasks are stored in <code>EnetApp_ModuleCtx_t gModCtxTable</code> task's table.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2038"></a>
Uniconf configuration</h2>
<p>Universal configuration daemon for Yang, provides APIs for developing a client application which retreives/writes yang parameters from/to database and ask the uniconf for configurating HW.</p>
<p>Uniconf supports the following config paramaters:</p>
<div class="fragment"><div class="line">typedef struct ucman_data {</div>
<div class="line">    const char *dbname;</div>
<div class="line">    const char **configfiles;</div>
<div class="line">    int numconfigfile;</div>
<div class="line">    uint8_t ucmode;</div>
<div class="line">    bool *stoprun;</div>
<div class="line">    int rval;</div>
<div class="line">    UC_NOTICE_SIG_T *ucmanstart;</div>
<div class="line">    const char *hwmod;</div>
<div class="line">} ucman_data_t;</div>
</div><!-- fragment --><ul>
<li><code>dbname</code>: Specify the path of database file in the file system. If user wants to write all config parameters to database file to make the config parameter persist after a reboot, the full path of database file must be set via this parameter. Currently, as file system is not supported, this parameter is set to <code>NULL</code>.</li>
<li><code>configfiles</code>: array of runtime config files will be used by the uniconf. Run time config file is a text file which has one-to-one mapping with yang files, the format of each line of a run time config file is specified under <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_uniconf/README.org</code>. Currently, as file system is not supported, this parameter is set to <code>NULL</code>.</li>
<li><code>numofconfigfile</code>: Specify how many config files have been set via the the <code>configfiles</code> array above. Currently, this parameter is set to <code>0</code>.</li>
<li><code>ucmode</code>: This is for setting the expected mode of uniconf. The uniconf can only run in a separated thread, please set <code>UC_CALLMODE_THREAD|UC_CALLMODE_UNICONF</code> for this parameter.</li>
<li><code>stoprun</code>: Address to a flag which signals the uniconf to stop in case the flag is true.</li>
<li><code>rval</code>: Error code of the uniconf in case error occurs.</li>
<li><code>ucmanstart</code>: The name of semaphore or a semaphore object in case of FreeRTOS. If this parameter is not <code>NULL</code>, the uniconf will post this semaphore to signal application layer indicating that it has been started successfully.</li>
<li><code>hwmod</code>: Configure the HW for the uniconf. If an empty string is specified (hwmod=""), it means the uniconf will configure HW. If "NONE" is specified (hwmod="NONE"), the uniconf will not configure HW when client side writes the database and ask it for an update.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2039"></a>
gPTP Yang Config Parameters</h2>
<p>This section describes the standard Yang parameters utilized for gPTP. To access the list of these parameters along with their default values for gPTP, please refer to the file located at: <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_gptp/gptpconf/gptp-yangconfig.xml</code>.</p>
<p>For detailed descriptions of each parameter, please refer to the following Yang files: <a href="https://github.com/YangModels/yang/blob/main/standard/ieee/draft/1588/ieee1588-ptp.yang">https://github.com/YangModels/yang/blob/main/standard/ieee/draft/1588/ieee1588-ptp.yang</a> <a href="https://github.com/YangModels/yang/blob/main/standard/ieee/draft/802.1/ASdn/ieee802-dot1as-ptp.yang">https://github.com/YangModels/yang/blob/main/standard/ieee/draft/802.1/ASdn/ieee802-dot1as-ptp.yang</a></p>
<p>To modify the default value of the Yang parameters, please refer to the <code>gptp_yang_config()</code> function in the <code>tsninit.c</code> file. This function will demonstrate how to update the parameter values at runtime.</p>
<h2><a class="anchor" id="autotoc_md2040"></a>
gPTP Non-Yang Config Parameters</h2>
<p>In addition to the standard Yang parameters, gPTP also includes a set of non-Yang configuration parameters that are specific to its implementation. To access the list of these parameters, along with their descriptions and default values for gPTP, please refer to the file located at: <code>&lt;mcu_plus_sdk&gt;/source/networking/tsn/tsn-stack/tsn_gptp/gptpconf/gptp_nonyangconfig.xml</code>.</p>
<p>To modify the default value of the Non-Yang parameters, please refer to the <code>gptp_nonyang_config()</code> function in the <code>tsninit.c</code> file. This function will invokes <code>gptpgcfg_set_item()</code> to configure each params:</p>
<div class="fragment"><div class="line">int gptpgcfg_set_item(uint8_t gptpInstanceIndex, uint8_t confitem,</div>
<div class="line">                        bool status, void *value, uint32_t vsize);</div>
</div><!-- fragment --><ul>
<li><code>gptpInstanceIndex</code> : Index of the gptp to be configured. For TI FreeRTOS there is only one instance is applicable, this should be set to 0.</li>
<li><code>confitem</code>: The configuration item. To create an item, prepend the parameter name from the gptp_nonyangconfig.xml with the "XL4_EXTMOD_XL4GPTP" prefix, as follows: "USE_HW_PHASE_ADJUSTMENT" becomes "XL4_EXTMOD_XL4GPTP_USE_HW_PHASE_ADJUSTMENT."</li>
<li><code>status</code>: <code>YDBI_CONFIG</code> or <code>YDBI_STATUS</code>. <code>YDBI_CONFIG</code> is used to configure the parameter at runtime. <code>YDBI_STATUS</code> is used to configure the parameter at runtime and store the value in the database for persistence.</li>
<li><code>value</code>: Pointer to the value to be set.</li>
<li><code>vsize</code>: Size of the value to be set, for the items.</li>
</ul>
<p>Example usage: <code>gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_USE_HW_PHASE_ADJUSTMENT, YDBI_CONFIG, &amp;use_hwphase, sizeof(use_hwphase));</code></p><ul>
<li>As a reference, please consult the <code>&lt;mcu_plus_sdk&gt;/examples/networking/tsn/tsninit.c</code> file.</li>
<li>The configuration must be done before calling the <code>gptpman_run()</code> function inside the <code>tsninit.c</code> file, and it should follow the the gptpgcfg_init function call.</li>
</ul>
<h3><a class="anchor" id="autotoc_md2041"></a>
gPTP Performance optimization</h3>
<p>Out of box configuration is not optimized for performance as the connected devices (e.g. Intel I218/219) may not be compatible with these optimal configuration. The following configurations can be tuned for optimizing the gPTP performance:</p>
<ul>
<li><code>XL4_EXTMOD_XL4GPTP_CLOCK_COMPUTE_INTERVAL_MSEC</code>: The interval in milliseconds at which the gPTP clock is computed. The default value is currently set to <code>1000</code>, and has a parameter vsize of <code>1</code> (uint8_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_UPDATE_MRATE_PPB</code>: The rate at which the frequency offset is updated. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_PHASE_OFFSET_IIR_ALPHA_STABLE_VALUE</code>: The reciprocal of this is the alpha value of the IIR filter used to compute the phase offset. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
<li><code>XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_IIR_ALPHA_STABLE_VALUE</code>: The reciprocal of this is the alpha value of the IIR filter used to compute the frequency offset. The default value is currently set to <code>10</code>, and has a parameter vsize of <code>4</code> (uint32_t).</li>
</ul>
<p>e.g. The following is an example configuration which you can use in the example to get better accuaracy if compatible with your devices in the setup. The following configuration is tested with the Intel I210 card and in between two EVMs.</p>
<div class="fragment"><div class="line">uint8_t compute_interval = 100;</div>
<div class="line">uint32_t freq_offset_update_mrate_ppb = 5;</div>
<div class="line">uint32_t phase_offset_iir_alpha_stable_value = 1;</div>
<div class="line">uint32_t freq_offset_iir_alpha_stable_value = 2;</div>
<div class="line"> </div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_CLOCK_COMPUTE_INTERVAL_MSEC, YDBI_CONFIG, &amp;compute_interval, sizeof(compute_interval));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_UPDATE_MRATE_PPB, YDBI_CONFIG, &amp;freq_offset_update_mrate_ppb, sizeof(freq_offset_update_mrate_ppb));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_PHASE_OFFSET_IIR_ALPHA_STABLE_VALUE, YDBI_CONFIG, &amp;phase_offset_iir_alpha_stable_value, sizeof(phase_offset_iir_alpha_stable_value));</div>
<div class="line">gptpgcfg_set_item(gpoptd.instnum, XL4_EXTMOD_XL4GPTP_FREQ_OFFSET_IIR_ALPHA_STABLE_VALUE, YDBI_CONFIG, &amp;freq_offset_iir_alpha_stable_value, sizeof(freq_offset_iir_alpha_stable_value));</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2042"></a>
Limitations</h1>
<p>For all parameters related to interval, the minimum interval can be configured for gPTP is 7.8125ms. The reason for that minimum interval is the implementation uses a base timer which has minimum period is 7.8125ms. Thus, increasing the interval parameters like <code>sync-interval</code> which is not a multiple of 7.8125ms may produce inaccurate interval of sending sync message.Or reducing interval of sync message below 7.8125ms is not possible. And the same limitation applied for all remaining interval parameters.</p>
<h1><a class="anchor" id="autotoc_md2043"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
