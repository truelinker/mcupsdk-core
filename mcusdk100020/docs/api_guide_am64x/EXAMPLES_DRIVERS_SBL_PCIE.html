<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: SBL PCIE</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_PCIE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL PCIE </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md776">Introduction</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_SBL_PCIE_COMBOS">Supported Combinations</a><ul><li class="level2"><a href="#autotoc_md777">HW Setup</a><ul><li class="level3"><a href="#autotoc_md778">AM64X-EVM</a></li>
</ul>
</li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md779">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md780">See Also</a></li>
<li class="level1"><a href="#autotoc_md781">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_pcie"></a></p>
<h1><a class="anchor" id="autotoc_md776"></a>
Introduction</h1>
<p>This bootloader does SOC initializations and attempts to boot a multicore appimage that is received over PCIe.</p>
<p>This example works in conjunction with the <a class="el" href="EXAMPLES_DRIVERS_SBL_PCIE_HOST.html">SBL PCIE HOST</a> application that sends over the image to the target board via PCIe. The bootloader then configures the inbound ATU region for receiving the appimage and an outbound ATU region to send out a handshake signal to indicate the bootloader is ready to accept application image.</p>
<p>The host application <a class="el" href="EXAMPLES_DRIVERS_SBL_PCIE_HOST.html">SBL PCIE HOST</a> on receiving the handshake signal from the bootloader send the application image via PCIe and marks a magic word to indicate transfer complete and marks the relative offset to which image is flashed.</p>
<p>On receiving the multicore appimage, the SBL then parses it, splits it into RPRCs for each core applicable. Each core is then initialized, RPRC image is loaded, entry points are set and the core is released from reset. For more on bootflow/bootloaders, please refer <a class="el" href="BOOTFLOW_GUIDE.html">Understanding the bootflow and bootloaders</a></p>
<p> <style>div.image img[src="pcie_bootflow.png"]{width:60%}</style> </p><div class="image">
<img src="pcie_bootflow.png" alt=""/>
<div class="caption">
PCIe bootflow</div></div>
<dl class="section note"><dt>Note</dt><dd>This bootloader application can also be run from other bootmedia (Serial Flash, UART, SD etc), and the bootloader can receive subsequent appimage via PCIe. When not booted from PCIe bootmode, the bootloader needs to do PCIe initialization within the bootloader. Whereas when booting in PCIe bootmode, the bootloader need not reinitialize PCIe and do link training again. In this case the SBL will be reusing the PCIe configuration done by ROM. This can be changed via SysCfg to use ROM configuration or not use ROM configuration, i.e the bootloader is executed from PCIe bootmode or other bootmodes.</dd></dl>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_SBL_PCIE_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_pcie   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md777"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h3><a class="anchor" id="autotoc_md778"></a>
AM64X-EVM</h3>
<ul>
<li>For connecting two board in RC and EP mode a specialized cable as below is required  <style>div.image img[src="pcie_cable.png"]{ width:50%}</style> <div class="image">
<img src="pcie_cable.png" alt=""/>
</div>
</li>
<li>This cable can be obtained from Adex Electronics (<a href="https://www.adexelec.com">https://www.adexelec.com</a>).</li>
<li>Modify the cable to remove resistors in CK+ and CK- in order to avoid ground loops (power) and smoking clock drivers (clk+/-).</li>
<li>The ends of the modified cable should look like below:<ul>
<li><p class="startli">A side  <style>div.image img[src="pcie_cable_a1.png"]{width:90%}</style>  <style>div.image img[src="pcie_cable_a2.png"]{width:90%}</style></p>
<table style="border: 0 px">
<tr>
<td><div class="image">
<img src="pcie_cable_a1.png" alt=""/>
<div class="caption">
PCIe cable A side end 1</div></div>
  </td><td><div class="image">
<img src="pcie_cable_a2.png" alt=""/>
<div class="caption">
PCIe cable A side end 2</div></div>
   </td></tr>
</table>
</li>
<li><p class="startli">B side  <style>div.image img[src="pcie_cable_b1.png"]{width:90%}</style>  <style>div.image img[src="pcie_cable_b2.png"]{width:90%}</style></p>
<table style="border: 0 px">
<tr>
<td><div class="image">
<img src="pcie_cable_b1.png" alt=""/>
<div class="caption">
PCIe cable B side end 1</div></div>
  </td><td><div class="image">
<img src="pcie_cable_b2.png" alt=""/>
<div class="caption">
PCIe cable B side end 2</div></div>
   </td></tr>
</table>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md779"></a>
Steps to Run the Example</h1>
<p>Since this is a bootloader, the example will be run every time you boot an application using this example. ROM will be receiving the bootloader over PCIe and SBL will be receiving appimage via PCIe. This example can be build using makjefile or build via CCS by importing as a project.</p>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>The example needs to work in conjunction with <a class="el" href="EXAMPLES_DRIVERS_SBL_PCIE_HOST.html">SBL PCIE HOST</a> application that sends the images to ROM and SBL over PCIe.</li>
<li>The target board is booted in PCIe boot mode, and the host side application is run on the other board connected.</li>
</ul>
<h1><a class="anchor" id="autotoc_md780"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></p>
<h1><a class="anchor" id="autotoc_md781"></a>
Sample Output</h1>
<div class="fragment"><div class="line">DMSC Firmware Version 8.5.3--v08.05.03 (Chill Capybar</div>
<div class="line">DMSC Firmware revision 0x8</div>
<div class="line">DMSC ABI revision 3.1</div>
<div class="line"> </div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media       : PCIE</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Image Size  : 221 KB</div>
<div class="line">[BOOTLOADER_PROFILE] Cores present    :</div>
<div class="line">[BOOTLOADER PROFILE] SYSFW init                       :      12250us</div>
<div class="line">[BOOTLOADER PROFILE] System_init                      :      25723us</div>
<div class="line">[BOOTLOADER PROFILE] Drivers_open                     :         46us</div>
<div class="line">[BOOTLOADER PROFILE] Sciclient Get Version            :      10043us</div>
<div class="line">[BOOTLOADER PROFILE] Appimage reception via PCIE      :     492024us</div>
<div class="line">[BOOTLOADER PROFILE] CPU Load                         :      75179us</div>
<div class="line">[BOOTLOADER_PROFILE] SBL Total Time Taken             :     615267us</div>
<div class="line"> </div>
<div class="line">Image loading done, switching to application ...</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
