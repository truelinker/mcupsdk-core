<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: SBL DFU</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_DFU.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL DFU </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md826">Introduction</a></li>
<li class="level1"><a href="#EXAMPLES_DRIVERS_SBL_DFU_COMBOS">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md827">Steps to Run the Example</a></li>
<li class="level1"><a href="#autotoc_md828">Example Usage</a></li>
<li class="level1"><a href="#autotoc_md829">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_dfu"></a></p>
<h1><a class="anchor" id="autotoc_md826"></a>
Introduction</h1>
<p><b>SBL_DFU</b> is a bootloader which boots the multicore application received via USB DFU. It is analogous to <a class="el" href="EXAMPLES_DRIVERS_SBL_UART.html">SBL UART</a></p>
<ul>
<li>DFU which stands for (Device Firmware Upgrade) is a standard device class of <a class="el" href="USB_DEVICE_DRIVER.html">USB</a>. This application uses DFU to transfer appimages from host pc to RAM.<ul>
<li>It uses DFU class from TinyUSB stack please refer to <a class="el" href="USB_DEVICE_DRIVER.html">USB</a> for more information.</li>
</ul>
</li>
<li>SBL DFU implements the <b>dfu task</b> which receives the appimage and put it into a dedicated buffer in RAM memory. Once the manifestation stage of DFU state machine is completed and DFU state machine goes to IDLE state, then the dfu task will be exited and booting process of the received image will be initiated.</li>
<li>It uses bootloader APIs to do the SOC initializations. Once the appimage is received, the SBL parses it and splits the appimage into RPRCs where each RPRC image corresponds to a distinct core. After that it initializes each core and load the corresponding RPRC image. This step sets the entry points and the core is then released from reset.</li>
<li>Refer to <a href="https://www.usb.org/sites/default/files/DFU_1.1.pdf">DFU_1.1.pdf</a> to know more about USB DFU class.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>This bootloader performs memory boot i.e it directly boots from the appimage received in RAM buffer. Due to this as of now the maximum boot image size supported with SBL DFU is <b>384KB</b></dd></dl>
<h1><a class="anchor" id="EXAMPLES_DRIVERS_SBL_DFU_COMBOS"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm, am64x-sk   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_dfu   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md827"></a>
Steps to Run the Example</h1>
<p>Since this is a bootloader and is used as a SOC initialization binary, the example will be run every time you boot an application using this example. It is generally run from a boot media (OSPI Flash, SD Card or over UART) unlike other examples which are usually loaded with CCS. Nevertheless, you can build this example like you do for the others using makefile or build it via CCS by importing as a project.</p>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a> )</li>
</ul>
<h1><a class="anchor" id="autotoc_md828"></a>
Example Usage</h1>
<ul>
<li>Make sure that <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_DFU_UTIL">dfu-util</a> tool is installed on your host pc. In case of windows make sure that appropriate windows USB generic drivers are installed.</li>
<li>The application boot is a 4 step process.</li>
</ul>
<ol type="1">
<li>Put the device into DFU boot mode <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a></li>
<li>Connect the USB cable to the HOST PC and observer that correct DFU device is detected.</li>
<li>Run the following command which uses <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_DFU_UTIL">dfu-util</a> to send the SBL DFU bootloader tiimage.</li>
</ol>
<pre class="fragment">    sudo dfu-util -i 0 -a 0 &lt;path to mcu_plus_sdk&gt;/tools/boot/sbl_prebuilt/am64x-evm/sbl_dfu.release.hs_fs.tiimage 
</pre><p> <style>div.image img[src="sbl_dfu_rom.png"]{width:50%}</style> </p><div class="image">
<img src="sbl_dfu_rom.png" alt=""/>
<div class="caption">
DFU ROM boot log</div></div>
<p>4 Run the following command which uses <a class="el" href="SDK_DOWNLOAD_PAGE.html#INSTALL_DFU_UTIL">dfu-util</a> tool to send the appimages. SBl DFU receives that and boots the application. </p><pre class="fragment">sudo dfu-util -i 0 -a 0 -D &lt;path to appimage&gt;
</pre><ul>
<li>Another option is to use the <a class="el" href="TOOLS_BOOT.html#USB_BOOTLOADER">USB Bootloader Python Script</a> which abstracts the setps 3 and 4 mentioned above.</li>
</ul>
<h1><a class="anchor" id="autotoc_md829"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></p>
<p><a class="el" href="TOOLS_FLASH.html#TOOLS_FLASH_DFU_UNIFLASH">USB DFU Uniflash</a>.</p>
<p><a class="el" href="TOOLS_FLASH.html">Flashing Tools</a></p>
<p><a class="el" href="GETTING_STARTED_FLASH_DFU.html">Flash a Hello World example using DFU</a></p>
<p><a class="el" href="TOOLS_BOOT.html#USB_BOOTLOADER">USB Bootloader Python Script</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
