<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM64x MCU+ SDK: Enet Layer 2 Multi-Channel Example</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() {
    if ($('.searchresults').length > 0) { searchBox.DOMSearchField().focus(); }
  });
  /* @license-end */
</script>
<link rel="search" href="search_opensearch.php?v=opensearch.xml" type="application/opensearchdescription+xml" title="AM64x MCU+ SDK"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM64x MCU+ SDK
   &#160;<span id="projectnumber">10.00.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
          <div class="left">
            <form id="FSearchBox" action="search.html" method="get">
              <img id="MSearchSelect" src="search/mag.svg" alt=""/>
              <input type="text" id="MSearchField" name="query" value="Search" size="20" accesskey="S" 
                     onfocus="searchBox.OnSearchFieldFocus(true)" 
                     onblur="searchBox.OnSearchFieldFocus(false)"/>
            </form>
          </div><div class="right"></div>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_ENET_LAYER2_MULTI_CHANNEL.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Enet Layer 2 Multi-Channel Example </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1091">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1092">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1093">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1094">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1095">HW Setup</a><ul><li class="level3"><a href="#autotoc_md1096">AM64X-EVM</a><ul><li class="level4"><a href="#autotoc_md1097">For CPSW based example</a></li>
</ul>
</li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md1098">Run the example</a></li>
<li class="level2"><a href="#autotoc_md1099">Sample output for Multi-Channel example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1100">See Also</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_networking_enet_layer2_multi_channel"></a></p>
<h1><a class="anchor" id="autotoc_md1091"></a>
Introduction</h1>
<p>The Multi-channel example illustrates the usage of multiple channels of UDMA. The application creates two independent TX and RX channels each, one for L2 echo server and the second for TimeSync PTP stack.</p>
<ul>
<li>Enet-lld utilizes hardware timestamping provided by CPTS(CPSW) and provides IOCTL commands for enabling Packet Timestamping functionality.</li>
<li>The Multi-channel example illustrates using three such IOCTL Commands to exercise the CPTS IOCTLs from application(<a class="el" href="group__ENET__MOD__TIMESYNC.html#ggaaf38d27f2346094db6344f81685a3a7dae1df89e88b8218322d89b3623486944e">ENET_TIMESYNC_IOCTL_GET_CURRENT_TIMESTAMP</a>, <a class="el" href="group__ENET__MOD__TIMESYNC.html#ggaaf38d27f2346094db6344f81685a3a7da026b1d4ec4b6a5fb1c11b8fd24ac9fa1">ENET_TIMESYNC_IOCTL_GET_ETH_RX_TIMESTAMP</a>, <a class="el" href="group__ENET__MOD__TIMESYNC.html#ggaaf38d27f2346094db6344f81685a3a7da224b4b0b9042d42ab524d61615c9db02">ENET_TIMESYNC_IOCTL_GET_ETH_TX_TIMESTAMP</a>). Appropriate apis are defined for calling these IOCTLs and enet-lld has implementation for the IOCTLs to execute the desired feature.</li>
<li>This example also illustrates on registering for CPTS event notification by using IOCTL ref\ CPSW_CPTS_IOCTL_REGISTER_STACK .</li>
<li>Moreover, the example also has a demo of 'PTP Ordinary Clock' using a combined Timesync PTP stack using P2P delay mechanism.</li>
<li>Please refer <a class="el" href="group__ENET__MOD__TIMESYNC.html">Enet Time Synchronization</a> for details on all other IOCTLs supported by ENET-LLD for Timesync.</li>
</ul>
<p>On AM64X, we can do ethernet based communication using CPSW HW mechanism</p>
<ul>
<li>CPSW is a standard ethernet switch + port HW</li>
<li>It uses ethernet driver underneath with LwIP TCP/IP networking stack</li>
</ul>
<h1><a class="anchor" id="autotoc_md1092"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0_freertos r5fss0-1_freertos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am64x-evm   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/networking/enet_layer2_multi_channel/V0   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1093"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1094"></a>
Build the example</h2>
<ul>
<li>When using CCS projects to build, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li>When using makefiles to build, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md1095"></a>
HW Setup</h2>
<dl class="section note"><dt>Note</dt><dd>Make sure you have setup the EVM with cable connections as shown here, <a class="el" href="EVM_SETUP_PAGE.html">EVM Setup</a>. In addition do below steps.</dd></dl>
<h3><a class="anchor" id="autotoc_md1096"></a>
AM64X-EVM</h3>
<h4><a class="anchor" id="autotoc_md1097"></a>
For CPSW based example</h4>
<ul>
<li>Connect a ethernet cable to the EVM from host PC as shown below</li>
</ul>
<p> <style>div.image img[src="am64x_evm_lwip_example_00.png"]{width:30%}</style> </p><div class="image">
<img src="am64x_evm_lwip_example_00.png" alt=""/>
<div class="caption">
Ethernet cable for CPSW based ethernet</div></div>
<h2><a class="anchor" id="autotoc_md1098"></a>
Run the example</h2>
<dl class="section attention"><dt>Attention</dt><dd>If you need to reload and run again, a CPU power-cycle is MUST</dd></dl>
<ul>
<li>Launch a CCS debug session and run the example executable, see <a class="el" href="CCS_LAUNCH_PAGE.html">CCS Launch, Load and Run</a></li>
<li>You will see logs in the UART terminal as shown in the next section.</li>
<li>We can start sending packets with Multicast addresses (01:80:C2:00:00:0E) PTP frames (Ethertype 0x88F7U) from Colasoft Pkt Builder or packETH tool and capture the packets in Wireshark. Packets must be sent without 802.1Q VLAN tag enabled to the application.</li>
<li>By selecting 't' option from the menu we can toggle the timestamp printing on the Terminal.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1099"></a>
Sample output for Multi-Channel example</h2>
<div class="fragment"><div class="line">==========================</div>
<div class="line">      Multi-Channel Test</div>
<div class="line">==========================</div>
<div class="line">Init Enet&#39;s OSAL and utils to use defaults</div>
<div class="line">Init memory utils</div>
<div class="line">Create clock and task for periodic tick</div>
<div class="line">Create periodic tick task</div>
<div class="line">Create periodic tick clock</div>
<div class="line">Open Main UDMA driver</div>
<div class="line"> </div>
<div class="line">Init all peripheral clocks</div>
<div class="line">----------------------------------------------</div>
<div class="line">Enabling clocks!</div>
<div class="line"> </div>
<div class="line">Init all configs</div>
<div class="line">----------------------------------------------</div>
<div class="line">cpsw-3g: init config</div>
<div class="line"> </div>
<div class="line">Create RX tasks</div>
<div class="line">----------------------------------------------</div>
<div class="line">cpsw-3g: Create RX task</div>
<div class="line"> </div>
<div class="line">Open all peripherals</div>
<div class="line">----------------------------------------------</div>
<div class="line">cpsw-3g: Open enet</div>
<div class="line"> </div>
<div class="line">Attach core id 1 on all peripherals</div>
<div class="line">----------------------------------------------</div>
<div class="line">cpsw-3g: Attach core</div>
<div class="line">cpsw-3g: Open port 1</div>
<div class="line">cpsw-3g: Open port 1 link</div>
<div class="line">cpsw-3g: Open DMA</div>
<div class="line">initQs() txFreePktInfoQ initialized with 16 pkts</div>
<div class="line">cpsw-3g: Waiting for link up...</div>
<div class="line">MAC Port 1: link up</div>
<div class="line">cpsw-3g: Port 1 link is up</div>
<div class="line">cpsw-3g: MAC port addr: f4:84:4c:f9:88:c4</div>
<div class="line"> </div>
<div class="line">Enet Multi-Channel Menu:</div>
<div class="line"> &#39;c&#39;  -  GetCurrentTime</div>
<div class="line"> &#39;t&#39;  -  Toggle Printing timestamps</div>
<div class="line"> &#39;s&#39;  -  Print statistics</div>
<div class="line"> &#39;r&#39;  -  Reset statistics</div>
<div class="line"> &#39;m&#39;  -  Show allocated MAC addresses</div>
<div class="line"> &#39;x&#39;  -  Stop the test</div>
<div class="line"> </div>
<div class="line">t</div>
<div class="line"> </div>
<div class="line">Enable Timestamp Printing</div>
<div class="line">RX PTP time is : 13219154567</div>
<div class="line">TX PTP time is : 13219204642</div>
<div class="line">RX PTP time is : 14222561337</div>
<div class="line">TX PTP time is : 14222608577</div>
<div class="line">RX PTP time is : 15237477912</div>
<div class="line">TX PTP time is : 15237519097</div>
<div class="line">RX PTP time is : 16238653702</div>
<div class="line">TX PTP time is : 16238698897</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1100"></a>
See Also</h1>
<p><a class="el" href="NETWORKING.html">Ethernet And Networking</a> |</p>
<p><a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_BRIDGE.html">Ethernet TSN CPSW gPTP Bridge Example</a> | <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TR.html">Ethernet TSN CPSW gPTP TimeReceiver (gPTP Slave) Example</a> | <a class="el" href="EXAMPLES_ENET_CPSW_TSN_GPTP_TT.html">Ethernet TSN CPSW gPTP TimeTransmitter (gPTP Master) Example</a> | <a class="el" href="ENET_CPSW_TSN_GPTP.html">Ethernet TSN and gPTP Stack - API and Integration Guide</a> </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
